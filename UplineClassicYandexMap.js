!function(){function o(o,e){let t="";const i=String(o).toLowerCase().split("_");return t=i[1]?i.map((o,e)=>e>0?n(o):o).join(""):i[0],e?n(t):t}function e(o="",e="",n="",t=!1){return`islands#${o||"blue"}${e}${t?"Circle":""}${n}Icon`}function n(o){return o.charAt(0).toUpperCase()+o.slice(1)}function t(e){const n={};return e.clusterize&&(n.clusterize={},n.clusterize.clusterize=e.clusterize,n.clusterize.clusterDisableClickZoom=e.cluster_disable_click_zoom,n.clusterize.clusterHasBalloon=e.cluster_has_balloon,e.clusterize&&e.set_cluster_options&&(n.clusterize.preset=function(e,n){if(n)return`islands#inverted${o(e,!0)}ClusterIcons`;return`islands#${o(e,!1)}ClusterIcons`}(e.cluster_options_color,e.cluster_is_invert),n.clusterize.clusterBalloonContentLayout=`cluster#${o(e.cluster_balloon_content_layout,!1)}`)),e.set_cluster_caption&&(n.clusterCaption=e.cluster_caption),n}function i(n,i){const r={};return r.common=function(o){const e={};return o.latitude&&(e.lat=o.latitude),o.longitude&&(e.lon=o.longitude),o.id&&(e.id=o.id),e}(n),r.map=function(o,e){const n={};if(o.set_center)n.center=!0,n.centerCoordinates=[Number(o.center_lat),Number(o.center_lon)],n.zoom=o.zoom;else{const t=e[o.latitude]||null,i=e[o.longitude]||null;n.centerCoordinates=t&&i?[t,i]:[55.831903,37.411961],n.zoom=15}return o.change_controls&&(n.controls=[],o.control_zoom_control&&n.controls.push("zoomControl"),o.control_search_control&&n.controls.push("searchControl"),o.control_type_selector&&n.controls.push("typeSelector"),o.control_fullscreen_control&&n.controls.push("fullscreenControl"),o.control_route_button_control&&n.controls.push("routeButtonControl"),o.control_ruler_control&&n.controls.push("rulerControl"),o.control_geolocation_control&&n.controls.push("geolocationControl"),o.control_traffic_control&&n.controls.push("trafficControl")),n}(n,i),r.marker=function(n){const t={};if(n.set_point_options){switch(t.pointColor=o(n.point_options_color,!1),n.set_point_options_color_field&&n.point_options_color_field&&(t.colorField=n.point_options_color_field),n.point_round_marker&&(t.circle=!0),n.point_options_kind){case"dot":t.pointType="Dot";break;case"num":t.pointType="",t.numberField=n.point_options_number_field;break;case"text":t.pointType="Stretchy",t.circle=!1,t.pointText=n.point_options_text_default,t.textField=n.point_options_text_field;break;case"icon":t.pointIcon=o(n.point_options_icon_item,!0),t.iconField=n.point_options_icon_field;break;case"img":t.iconImage=!0,t.iconImageHref=n.marker_icon_image_href,t.iconImageSize=[n.marker_icon_image_width_size,n.marker_icon_image_height_size],t.iconImageOffset=[n.marker_icon_image_x_offset,n.marker_icon_image_y_offset],t.iconImageHrefField=n.marker_icon_image_href_field,t.iconImageSizeWidthField=n.marker_icon_image_size_width_field,t.iconImageSizeHeightField=n.marker_icon_image_size_height_field,t.iconImageOffsetXField=n.marker_icon_image_offset_x_field,t.iconImageOffsetYField=n.marker_icon_image_offset_y_field}t.kind=n.point_options_kind,t.pointPreset=e(t.pointColor,t.pointIcon,t.pointType,t.circle)}return n.set_icon_caption&&n.icon_caption&&(t.iconCaption=n.icon_caption),t}(n),r.cluster=t(n),r.balloon=function(o){const e={};return e.markBallon=o.mark_has_balloon,o.balloon_content_header&&(e.balloonContentHeader=o.balloon_content_header),o.balloon_content_body&&(e.balloonContentBody=o.balloon_content_body),o.balloon_content_footer&&(e.balloonContentFooter=o.balloon_content_footer),e}(n),r.list=void 0,r}function r(o,e,n,t){const i=document.querySelector(".upym__list"),r=document.querySelector(".upym__template").innerHTML;let l;if(l=o.map(function(o){const n=function(o,e){return{f1:o[e.f1],f2:o[e.f2],f3:o[e.f3],f4:o[e.f4],f5:o[e.f5],f6:o[e.f6],f7:o[e.f7],f8:o[e.f8]}}(o,e);return function(o,e){return o.replace(/{{f\d}}/gi,o=>{const n=o.slice(2,o.length-2);return e[n]})}(r,n)}).join(""),i.innerHTML=l,!e.show_list_items_on_start){const o=t.querySelector(".upym__contatiner");o.classList.contains("show__list")||(o.classList.add("show__list"),n.container.fitToViewport())}}window.crUplineYandexMap=function(n,t,l){const c=i(n,t.rows[0]),a=function(n,t){const i={type:"FeatureCollection",features:n.map(function(n,i){const r=t.marker,l=t.common,c=t.balloon,a=t.cluster,s=n[l.lat],_=n[l.lon],u=n[l.id],d=n[r.numberField]||null,p=n[r.textField]||null,f=p||d||r.pointText,m=o(n[r.colorField],!1),g=function(o){return["blue","darkblue","lightblue","yellow","green","darkgreen","olive","brown","red","orange","darkorange","pink","gray","night","black","violet"].includes(o.toLowerCase())}(m)?m:r.pointColor;let b="";if("icon"===r.kind){const e=o(n[r.iconField],!0);b=function(o){return["Airport","Attention","Auto","Bar","Barber","Beach","Bicycle","Bicycle2","Book","CarWash","Christian","Cinema","Circus","Court","Delivery","Discount","Dog","Education","EntertainmentCenter","Factory","Family","Fashion","Food","FuelStation","Garden","Government","Heart","Home","Hotel","Hydro","Info","Laundry","Leisure","MassTransit","Medical","Money","Mountain","NightClub","Observation","Park","Parking","Person","Pocket","Pool","Post","Railway","RapidTransit","RepairShop","Run","Science","Shopping","Souvenirs","Sport","Star","Theater","Toilet","Underpass","Vegetation","Video","Waste","WaterPark","Waterway","Worship","Zoo"].includes(o)}(e)?e:r.pointIcon}const h={type:"Feature"};u&&(h.id=u),s&&_&&(h.geometry={type:"Point",coordinates:[s,_]});const C={};if(f&&(C.iconContent=f),n[c.balloonContent]&&(C.balloonContent=n[c.balloonContent]),n[a.clusterCaption]&&(C.clusterCaption=n[a.clusterCaption]),n[r.iconCaption]&&(C.iconCaption=n[r.iconCaption]),n[c.balloonContentHeader]&&(C.balloonContentHeader=n[c.balloonContentHeader]),n[c.balloonContentBody]&&(C.balloonContentBody=n[c.balloonContentBody]),n[c.balloonContentFooter]&&(C.balloonContentFooter=n[c.balloonContentFooter]),h.options={preset:e(g,b,r.pointType,r.circle),openBalloonOnClick:t.balloon.markBallon},r.iconImage){const o=n[r.iconImageHrefField]?n[r.iconImageHrefField]:r.iconImageHref,e=n[r.iconImageSizeWidthField]?n[r.iconImageSizeWidthField]:"",t=n[r.iconImageSizeHeightField]?n[r.iconImageSizeHeightField]:"",i=n[r.iconImageSizeWidthField]&&n[r.iconImageSizeHeightField]?[e,t]:r.iconImageSize,l=n[r.iconImageOffsetXField]?n[r.iconImageOffsetXField]:"",c=n[r.iconImageOffsetYField]?n[r.iconImageOffsetYField]:"",a=n[r.iconImageOffsetXField]&&n[r.iconImageOffsetYField]?[l,c]:r.iconImageOffset;h.options.iconLayout="default#image",h.options.iconImageHref=o,h.options.iconImageSize=i,h.options.iconImageOffset=a}return h.properties=C,h})};return JSON.stringify(i)}(t.rows,c),s={center:c.map.centerCoordinates,zoom:c.map.zoom};c.map.controls&&(s.controls=c.map.controls);const _=new ymaps.Map(l,s);if(n.change_behaviors){const e=function(e){const n={enabled:[],disabled:[]};for(key in e)if(-1!==key.indexOf("behavior_")){const t=o(key.substring(9),!1);e[key]?n.enabled.push(t):n.disabled.push(t)}return n}(n);_.behaviors.disable(e.disabled).enable(e.enabled)}let u=new ymaps.ObjectManager(c.cluster.clusterize);u.add(a),_.geoObjects.add(u),n.set_center||_.setBounds(u.getBounds()),n.show_list&&(u.clusters.events.add(["click"],function(o){const e=u.clusters.getById(o.get("objectId")).properties.geoObjects.map(function(o,e){return o.id});r(t.rows.filter(o=>e.includes(o[c.common.id])),n,_,l)}),u.objects.events.add(["click"],function(o){const e=o.get("objectId");r(t.rows.filter(o=>e===o[c.common.id]),n,_,l)}),n.show_list_items_on_start&&r(t.rows,n,_,l))}}();