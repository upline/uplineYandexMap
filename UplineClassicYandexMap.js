!function(){function o(o,e){let n="";const i=String(o).toLowerCase().split("_");return n=i[1]?i.map((o,e)=>e>0?t(o):o).join(""):i[0],e?t(n):n}function e(o="",e="",t="",n=!1){return`islands#${o||"blue"}${e}${n?"Circle":""}${t}Icon`}function t(o){return o.charAt(0).toUpperCase()+o.slice(1)}function n(e){const t={};return e.clusterize&&(t.clusterize={},t.clusterize.clusterize=e.clusterize,t.clusterize.clusterDisableClickZoom=e.cluster_disable_click_zoom,t.clusterize.clusterHasBalloon=e.cluster_has_balloon,e.clusterize&&e.set_cluster_options&&(t.clusterize.preset=function(e,t){if(t)return`islands#inverted${o(e,!0)}ClusterIcons`;return`islands#${o(e,!1)}ClusterIcons`}(e.cluster_options_color,e.cluster_is_invert),t.clusterize.clusterBalloonContentLayout=`cluster#${o(e.cluster_balloon_content_layout,!1)}`)),e.set_cluster_caption&&(t.clusterCaption=e.cluster_caption),t}function i(t){const i={};return i.common=function(o){const e={};return o.latitude&&(e.lat=o.latitude),o.longitude&&(e.lon=o.longitude),o.id&&(e.id=o.id),e}(t),i.map=function(o,e){const t={};if(o.set_center)t.center=!0,t.centerCoordinates=[Number(o.center_lat),Number(o.center_lon)],t.zoom=o.zoom;else{const n=e[o.latitude]||null,i=e[o.longitude]||null;t.centerCoordinates=n&&i?[n,i]:[55.831903,37.411961],t.zoom=15}return o.change_controls&&(t.controls=[],o.control_zoom_control&&t.controls.push("zoomControl"),o.control_search_control&&t.controls.push("searchControl"),o.control_type_selector&&t.controls.push("typeSelector"),o.control_fullscreen_control&&t.controls.push("fullscreenControl"),o.control_route_button_control&&t.controls.push("routeButtonControl"),o.control_ruler_control&&t.controls.push("rulerControl"),o.control_geolocation_control&&t.controls.push("geolocationControl"),o.control_traffic_control&&t.controls.push("trafficControl")),t}(t,data.rows[0]),i.marker=function(t){const n={};if(t.set_point_options){switch(n.pointColor=o(t.point_options_color,!1),t.set_point_options_color_field&&t.point_options_color_field&&(n.colorField=t.point_options_color_field),t.point_round_marker&&(n.circle=!0),t.point_options_kind){case"dot":n.pointType="Dot";break;case"num":n.pointType="",n.numberField=t.point_options_number_field;break;case"text":n.pointType="Stretchy",n.circle=!1,n.pointText=t.point_options_text_default,n.textField=t.point_options_text_field;break;case"icon":n.pointIcon=o(t.point_options_icon_item,!0),n.iconField=t.point_options_icon_field;break;case"img":n.iconImage=!0,n.iconImageHref=t.marker_icon_image_href,n.iconImageSize=[t.marker_icon_image_width_size,t.marker_icon_image_height_size],n.iconImageOffset=[t.marker_icon_image_x_offset,t.marker_icon_image_y_offset],n.iconImageHrefField=t.marker_icon_image_href_field,n.iconImageSizeWidthField=t.marker_icon_image_size_width_field,n.iconImageSizeHeightField=t.marker_icon_image_size_height_field,n.iconImageOffsetXField=t.marker_icon_image_offset_x_field,n.iconImageOffsetYField=t.marker_icon_image_offset_y_field}n.pointPreset=e(n.pointColor,n.pointIcon,n.pointType,n.circle)}return t.set_icon_caption&&t.icon_caption&&(n.iconCaption=t.icon_caption),n}(t),i.cluster=n(t),i.balloon=function(o){const e={};return e.markBallon=o.mark_has_balloon,o.balloon_content_header&&(e.balloonContentHeader=o.balloon_content_header),o.balloon_content_body&&(e.balloonContentBody=o.balloon_content_body),o.balloon_content_footer&&(e.balloonContentFooter=o.balloon_content_footer),e}(t),i.list=void 0,i}function r(t,n){const i={type:"FeatureCollection",features:t.map(function(t,i){const r=n.marker,l=n.common,c=n.balloon,a=n.cluster,s=t[l.lat],_=t[l.lon],u=t[l.id],d=t[r.numberField]||null,p=t[r.textField]||null,f=p||(d||r.pointText),m=o(t[r.colorField],!1),g=function(o){return["blue","darkblue","lightblue","yellow","green","darkgreen","olive","brown","red","orange","darkorange","pink","gray","night","black","violet"].includes(o.toLowerCase())}(m)?m:r.pointColor;let b="";if("icon"===params.point_options_kind){const e=o(t[r.iconField],!0);b=function(o){return["Airport","Attention","Auto","Bar","Barber","Beach","Bicycle","Bicycle2","Book","CarWash","Christian","Cinema","Circus","Court","Delivery","Discount","Dog","Education","EntertainmentCenter","Factory","Family","Fashion","Food","FuelStation","Garden","Government","Heart","Home","Hotel","Hydro","Info","Laundry","Leisure","MassTransit","Medical","Money","Mountain","NightClub","Observation","Park","Parking","Person","Pocket","Pool","Post","Railway","RapidTransit","RepairShop","Run","Science","Shopping","Souvenirs","Sport","Star","Theater","Toilet","Underpass","Vegetation","Video","Waste","WaterPark","Waterway","Worship","Zoo"].includes(o)}(e)?e:r.pointIcon}const h={type:"Feature"};u&&(h.id=u),s&&_&&(h.geometry={type:"Point",coordinates:[s,_]});const C={};if(f&&(C.iconContent=f),t[c.balloonContent]&&(C.balloonContent=t[c.balloonContent]),t[a.clusterCaption]&&(C.clusterCaption=t[a.clusterCaption]),t[r.iconCaption]&&(C.iconCaption=t[r.iconCaption]),t[c.balloonContentHeader]&&(C.balloonContentHeader=t[c.balloonContentHeader]),t[c.balloonContentBody]&&(C.balloonContentBody=t[c.balloonContentBody]),t[c.balloonContentFooter]&&(C.balloonContentFooter=t[c.balloonContentFooter]),h.options={preset:e(g,b,r.pointType,r.circle),openBalloonOnClick:n.balloon.markBallon},r.iconImage){const o=t[r.iconImageHrefField]?t[r.iconImageHrefField]:r.iconImageHref,e=t[r.iconImageSizeWidthField]?t[r.iconImageSizeWidthField]:"",n=t[r.iconImageSizeHeightField]?t[r.iconImageSizeHeightField]:"",i=t[r.iconImageSizeWidthField]&&t[r.iconImageSizeHeightField]?[e,n]:r.iconImageSize,l=t[r.iconImageOffsetXField]?t[r.iconImageOffsetXField]:"",c=t[r.iconImageOffsetYField]?t[r.iconImageOffsetYField]:"",a=t[r.iconImageOffsetXField]&&t[r.iconImageOffsetYField]?[l,c]:r.iconImageOffset;h.options.iconLayout="default#image",h.options.iconImageHref=o,h.options.iconImageSize=i,h.options.iconImageOffset=a}return h.properties=C,h})};return JSON.stringify(i)}function l(o,e,t){const n=document.querySelector(".upym__list"),i=document.querySelector(".upym__template").innerHTML;let r;if(r=o.map(function(o){const t=function(o,e){return{f1:o[e.f1],f2:o[e.f2],f3:o[e.f3],f4:o[e.f4],f5:o[e.f5],f6:o[e.f6],f7:o[e.f7],f8:o[e.f8]}}(o,e);return function(o,e){return o.replace(/{{f\d}}/gi,o=>{const t=o.slice(2,o.length-2);return e[t]})}(i,t)}).join(""),n.innerHTML=r,!e.show_list_items_on_start){const o=el.querySelector(".upym__contatiner");o.classList.contains("show__list")||(o.classList.add("show__list"),t.container.fitToViewport())}}window.crUplineYandexMap=function(e,t,n){const c=i(e,t.rows[0]),a=r(t.rows,c);console.log(a);const s={center:c.map.centerCoordinates,zoom:c.map.zoom};c.map.controls&&(s.controls=c.map.controls);const _=new ymaps.Map(n,s);if(e.change_behaviors){const t=function(e){const t={enabled:[],disabled:[]};for(key in e)if(-1!==key.indexOf("behavior_")){const n=o(key.substring(9),!1);e[key]?t.enabled.push(n):t.disabled.push(n)}return t}(e);_.behaviors.disable(t.disabled).enable(t.enabled)}let u=new ymaps.ObjectManager(c.cluster.clusterize);u.add(a),_.geoObjects.add(u),e.set_center||_.setBounds(u.getBounds()),e.show_list&&(u.clusters.events.add(["click"],function(o){const n=u.clusters.getById(o.get("objectId")).properties.geoObjects.map(function(o,e){return o.id});l(t.rows.filter(o=>n.includes(o[c.common.id])),e,_)}),u.objects.events.add(["click"],function(o){const n=o.get("objectId");l(t.rows.filter(o=>n===o[c.common.id]),e,_)}),e.show_list_items_on_start&&l(t.rows,e,_))}}();